<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>CMS-1500 — Snapshot</title>

  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 18px; }
    h1 { margin-bottom: 6px; }
    .note { color:#555; font-size:12px; margin-bottom:12px; }
    .box { border:1px solid #333; padding:8px; margin-bottom:10px; }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap:6px; }
    .cell { border:1px solid #444; padding:6px; font-size:12px; }
    .label { font-weight:bold; font-size:11px; display:block; margin-bottom:4px; }
    table { border-collapse: collapse; width:100%; margin-top:10px; }
    th, td { border:1px solid #333; padding:6px; font-size:12px; vertical-align:top; }
    th { background:#eee; }
    .right { text-align:right; }
    .muted { color:#777; }
    .pending { background:#fafafa; color:#999; }
  </style>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/cms1500_print.css') }}" media="print">
</head>
<body>

<h1>CMS-1500 — Snapshot</h1>
<div class="note">
  Vista READ-ONLY. Los datos provienen de un snapshot inmutable.
</div>

<!-- ========================= -->
<!-- CASILLAS 1–13 -->
<!-- ========================= -->
<div class="box">
  <div class="grid">

    <div class="cell" style="grid-column: span 6;">
      <span class="label">1. Insurance Type</span>
      {{ snapshot.insurance.plan_name or "[Por definir]" }}
      <div class="muted"><strong>1a.</strong> {{ snapshot.insurance.insured_id or "—" }}</div>
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">2. Patient Name</span>
      {{ snapshot.patient.first_name }} {{ snapshot.patient.last_name }}
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">3. DOB / Sex</span>
      {{ snapshot.patient.date_of_birth or "—" }} | {{ snapshot.patient.sex or "—" }}
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">4. Insured Name</span>
      —
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">5. Patient Address / Phone</span>
      —
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">6. Relationship to Insured</span>
      {{ snapshot.patient.insured_relationship or "—" }}
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">7. Insured Address</span>
      —
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">8. Patient Status</span>
      —
    </div>

    <div class="cell" style="grid-column: span 12;">
      <span class="label">9. Other Insured (9a–9d)</span>
      —
    </div>

    <div class="cell" style="grid-column: span 12;">
      <span class="label">10. Condition Related To</span>
      —
    </div>

    <div class="cell" style="grid-column: span 12;">
      <span class="label">11. Policy / Group</span>
      {{ snapshot.insurance.policy_number or "—" }}
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">12. Patient Signature</span>
      Signature on File
    </div>

    <div class="cell" style="grid-column: span 6;">
      <span class="label">13. Insured Signature</span>
      Signature on File
    </div>

  </div>
</div>

<!-- ========================= -->
<!-- CASILLAS 14–23 -->
<!-- ========================= -->
<div class="box">
  <div class="grid">

    <div class="cell" style="grid-column: span 6;"><span class="label">14.</span> —</div>
    <div class="cell" style="grid-column: span 6;"><span class="label">15.</span> —</div>
    <div class="cell" style="grid-column: span 6;"><span class="label">16.</span> —</div>
    <div class="cell" style="grid-column: span 6;"><span class="label">17.</span> —</div>
    <div class="cell" style="grid-column: span 12;"><span class="label">18.</span> —</div>
    <div class="cell" style="grid-column: span 6;"><span class="label">19.</span> —</div>
    <div class="cell" style="grid-column: span 6;"><span class="label">20.</span> —</div>
    <div class="cell" style="grid-column: span 12;"><span class="label">21.</span> {{ snapshot.diagnoses.A or "—" }}</div>
    <div class="cell" style="grid-column: span 6;"><span class="label">22.</span> —</div>
    <div class="cell" style="grid-column: span 6;"><span class="label">23.</span> —</div>

  </div>
</div>

<!-- ========================= -->
<!-- SERVICIOS 24A–24J (+20) -->
<!-- ========================= -->
<div class="box">
  <table>
    <tr>
      <th>24A</th><th>24B</th><th>24C</th><th>24D</th><th>24E</th>
      <th>24F</th><th>24G</th><th>20</th><th>24I</th><th>24J</th>
    </tr>
    {% for s in snapshot.services %}
    <tr>
      <td>{{ s.service_date }}</td>
      <td>11</td>
      <td>N</td>
      <td>{{ s.cpt_code }}</td>
      <td>{{ s.dx_pointer or "A" }}</td>
      <td class="right">—</td>
      <td class="right">{{ s.units }}</td>
      <td>
        {% if s.outside_lab_20 %}
          Y<br>{{ s.lab_charges_20 or '' }}
        {% else %}
          N
        {% endif %}
      </td>
      <td></td>
      <td>
        {{ snapshot.provider.billing.name }}<br>
        NPI {{ snapshot.provider.billing.npi }}
      </td>
    </tr>
    {% endfor %}
  </table>
</div>

<!-- ========================= -->
<!-- 28–30 -->
<!-- ========================= -->
<div class="box">
  <strong>28:</strong> {{ snapshot.totals.total_charge }} |
  <strong>29:</strong> {{ snapshot.totals.amount_paid }} |
  <strong>30:</strong> {{ snapshot.totals.balance_due }}
</div>

<!-- ========================= -->
<!-- 31 / 32 / 33 (OFICIAL) -->
<!-- ========================= -->

<div class="box">
  <span class="label">31 — Rendering Provider</span>
  {{ snapshot.provider.signature }}<br>
  <span class="muted">Date:</span> {{ snapshot.provider.signature_date or '' }}
</div>

<div class="box">
  <span class="label">32 — Service Facility Location</span>
  {{ snapshot.provider.facility.name or '' }}<br>
  {{ snapshot.provider.facility.address or '' }}<br>
  {{ snapshot.provider.facility.city or '' }},
  {{ snapshot.provider.facility.state or '' }}
  {{ snapshot.provider.facility.zip or '' }}
</div>

<div class="box">
  <span class="label">33 — Billing Provider</span>
  {{ snapshot.provider.billing.name or '' }}<br>
  {{ snapshot.provider.billing.address or '' }}<br>
  {{ snapshot.provider.billing.city or '' }},
  {{ snapshot.provider.billing.state or '' }}
  {{ snapshot.provider.billing.zip or '' }}<br>
  <strong>NPI:</strong> {{ snapshot.provider.billing.npi or '' }}<br>
  <strong>Tax ID:</strong> {{ snapshot.provider.billing.tax_id or '' }}
</div>

</body>
</html>
