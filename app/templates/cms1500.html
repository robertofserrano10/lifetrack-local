<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>CMS-1500 — Snapshot</title>

  <style>
    /* ============ BASE ============ */
    body { font-family: Arial, Helvetica, sans-serif; margin: 18px; }
    h1 { margin: 0 0 6px 0; }
    .note { color:#555; font-size:12px; margin: 0 0 12px 0; }

    /* ============ BANDAS (papel) ============ */
    .band { border: 1px solid #333; margin-bottom: 10px; }
    .row  { display: grid; grid-template-columns: repeat(12, 1fr); gap: 0; }

    /* Anti-rotura: el grid NO debe explotar por texto largo */
    .cell{
      border-right: 1px solid #333;
      border-top: 1px solid #333;
      padding: 6px;
      font-size: 12px;
      min-height: 48px;
      box-sizing: border-box;
      vertical-align: top;

      /* CLAVE: permite que el contenido “quepa” */
      min-width: 0;
      overflow-wrap: anywhere;
      word-break: break-word;
      hyphens: auto;
    }
    .row:first-child .cell { border-top: none; }
    .cell:last-child { border-right: none; }
    .row { border-bottom: 1px solid #333; }
    .row:last-child { border-bottom: none; }

    .label { font-weight: bold; font-size: 10.5px; display: block; margin-bottom: 4px; line-height: 1.1; }
    .muted { color:#777; font-size: 11px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 11px; }

    /* Valores dentro de casillas: también “wrap” seguro */
    .val { white-space: normal; overflow-wrap: anywhere; word-break: break-word; }

    /* Checkboxes visuales (NO TOCAR lógica) */
    .cb { display:inline-block; width:14px; height:14px; border:1px solid #000; vertical-align:middle; margin-right:6px; position:relative; box-sizing:border-box; }
    .cb.checked:after { content:""; position:absolute; left:4px; top:1px; width:5px; height:9px; border-right:2px solid #000; border-bottom:2px solid #000; transform:rotate(45deg); }
    .opt { display:inline-block; white-space:nowrap; margin-right:12px; margin-bottom:4px; }
    .optblock { display:block; }

    /* Tablas (21 y 24): evitar que se “desborden” */
    table { border-collapse: collapse; width: 100%; table-layout: fixed; }
    th, td {
      border: 1px solid #333;
      padding: 6px;
      font-size: 12px;
      vertical-align: top;
      overflow-wrap: anywhere;
      word-break: break-word;
    }
    th { background:#eee; font-weight: bold; font-size: 11px; }
    .right { text-align: right; }

    /* Banda compacta (para 25–33) */
    .minh-36 { min-height: 36px; }

    /* ===== CMS-1500 | Header Casilla 24 (2 líneas reales) ===== */
th.th-24 {
  text-align: center;
  vertical-align: middle;
  padding: 4px 2px;
}

th.th-24 .code {
  display: block;          /* FUERZA línea 1 */
  font-weight: bold;
  font-size: 11px;
  line-height: 1.1;
}

th.th-24 .desc {
  display: block;          /* FUERZA línea 2 */
  font-weight: normal;
  font-size: 10px;
  line-height: 1.1;
  margin-top: 2px;         /* separación real */
}
  </style>

  <!-- CSS de impresión (ya lo tienes) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/cms1500_print.css') }}" media="print">
</head>

<body>
  <h1>CMS-1500 — Snapshot</h1>
  <div class="note">Vista READ-ONLY. Los datos provienen de un snapshot inmutable.</div>

  <!-- =========================
       BANDA 1: 1 / 1a / 2 / 3
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell" style="grid-column: span 4;">
        <span class="label">1. (Medicare, Medicaid, Tricare/CHAMPUS, CHAMPVA, Group Health Plan, FECA, Other)</span>
        <div class="val">{{ snapshot.insurance.plan_name or "—" }}</div>
        <div class="muted" style="margin-top:6px;">
          <strong>1a. Insured’s ID Number</strong>: <span class="val">{{ snapshot.insurance.insured_id or "—" }}</span>
        </div>
      </div>

      <div class="cell" style="grid-column: span 4;">
        <span class="label">2. Patient’s Name (Last Name, First Name, Middle Initial)</span>
        <div class="val">{{ (snapshot.patient.last_name or "") }}, {{ (snapshot.patient.first_name or "") }}</div>
      </div>

      <div class="cell" style="grid-column: span 4;">
        <span class="label">3. Patient’s Birth Date / Sex</span>
        <div class="val"><strong>Birth Date:</strong> {{ snapshot.patient.date_of_birth or "—" }}</div>
        <div class="val"><strong>Sex:</strong> {{ snapshot.patient.sex or "—" }}</div>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 2: 4 / 5 / 6 / 7
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell" style="grid-column: span 3;">
        <span class="label">4. Insured’s Name (Last Name, First Name, Middle Initial)</span>
        <div class="val">—</div>
      </div>

      <div class="cell" style="grid-column: span 3;">
        <span class="label">5. Patient’s Address (No., Street) / City / State / Zip / Telephone</span>
        <div class="val">—</div>
      </div>

      <div class="cell" style="grid-column: span 3;">
        <span class="label">6. Patient Relationship to Insured</span>
        {% set rel = snapshot.patient.relationship_to_insured or snapshot.patient.insured_relationship or "" %}
        <span class="opt"><span class="cb {{ 'checked' if rel=='self' else '' }}"></span>Self</span>
        <span class="opt"><span class="cb {{ 'checked' if rel=='spouse' else '' }}"></span>Spouse</span>
        <span class="opt"><span class="cb {{ 'checked' if rel=='child' else '' }}"></span>Child</span>
        <span class="opt"><span class="cb {{ 'checked' if rel=='other' else '' }}"></span>Other</span>
      </div>

      <div class="cell" style="grid-column: span 3;">
        <span class="label">7. Insured’s Address (No., Street) / City / State / Zip / Telephone</span>
        <div class="val">—</div>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 3: 8 / 9 / 10
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell" style="grid-column: span 4;">
        <span class="label">8. Patient Status</span>
        <div class="optblock">
          <span class="opt"><span class="cb"></span>Single</span>
          <span class="opt"><span class="cb"></span>Married</span>
          <span class="opt"><span class="cb"></span>Other</span>
        </div>
        <div class="optblock">
          <span class="opt"><span class="cb"></span>Employed</span>
          <span class="opt"><span class="cb"></span>Full-Time Student</span>
          <span class="opt"><span class="cb"></span>Part-Time Student</span>
        </div>
        <div class="muted">(visual por ahora)</div>
      </div>

      <div class="cell" style="grid-column: span 4;">
        <span class="label">9. Other Insured’s Name (Last Name, First Name, Middle Initial)</span>
        <div class="val">—</div>
      </div>

      <div class="cell" style="grid-column: span 4;">
        <span class="label">10. Is Patient’s Condition Related To?</span>
        <div class="optblock">
          <span class="opt"><span class="cb"></span>a. Employment?</span>
          <span class="opt"><span class="cb"></span>b. Auto Accident?</span>
        </div>
        <div class="optblock">
          <span class="opt"><span class="cb"></span>c. Other Accident?</span>
          <span class="opt"><span class="cb"></span>d. Claim Codes (Designated by NUCC): ____</span>
        </div>
        <div class="muted">(visual por ahora)</div>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 4: 11 / 12 / 13
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell" style="grid-column: span 8;">
        <span class="label">11. Insured’s Policy Group or FECA Number</span>
        <div class="val">{{ snapshot.insurance.policy_number or "—" }}</div>

        <div class="muted" style="margin-top:6px;">
          <div><strong>11a. Insured’s Date of Birth</strong>: —</div>
          <div><strong>11b. Other Claim ID</strong>: —</div>
          <div><strong>11c. Insurance Plan Name or Program Name</strong>: <span class="val">{{ snapshot.insurance.insurer_name or "—" }}</span></div>
          <div>
            <strong>11d. Is there another Health Benefit Plan?</strong>
            <span class="opt"><span class="cb"></span>Yes</span>
            <span class="opt"><span class="cb"></span>No</span>
          </div>
        </div>
      </div>

      <div class="cell" style="grid-column: span 2;">
        <span class="label">12. Patient’s or Authorized Person’s Signature</span>
        <span class="opt"><span class="cb checked"></span>Signature on File</span>
      </div>

      <div class="cell" style="grid-column: span 2;">
        <span class="label">13. Insured’s or Authorized Person’s Signature</span>
        <span class="opt"><span class="cb checked"></span>Signature on File</span>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 5: 14–20 / 22 / 23
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell minh-36" style="grid-column: span 2;"><span class="label">14. Date of Current Illness, Injury, or Pregnancy (LMP)</span><div class="val">—</div></div>
      <div class="cell minh-36" style="grid-column: span 2;"><span class="label">15. Other Date</span><div class="val">—</div></div>
      <div class="cell minh-36" style="grid-column: span 2;"><span class="label">16. Dates Patient Unable to Work in Current Occupation</span><div class="val">—</div></div>
      <div class="cell minh-36" style="grid-column: span 2;"><span class="label">17. Name of Referring Provider or Other Source</span><div class="val">—</div></div>
      <div class="cell minh-36" style="grid-column: span 2;"><span class="label">18. Hospitalization Dates Related to Current Services</span><div class="val">—</div></div>
      <div class="cell minh-36" style="grid-column: span 2;"><span class="label">19. Additional Claim Information (Designated by NUCC)</span><div class="val">—</div></div>
    </div>

    <div class="row">
      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">20. Outside Lab?</span>
        <div class="val">Outside Lab — see service section</div>
      </div>

      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">22. Resubmission Code / Original Ref. No.</span>
        <div class="val">—</div>
      </div>

      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">23. Prior Authorization Number</span>
        <div class="val">—</div>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 6: 21 A–L (tabla)
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell" style="grid-column: span 12;">
        <span class="label">21. Diagnosis or Nature of Illness or Injury (A–L)</span>

        <table>
          <tr>
            <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th>
            <th>G</th><th>H</th><th>I</th><th>J</th><th>K</th><th>L</th>
          </tr>
          <tr>
            <td>{{ snapshot.diagnoses.A or "—" }}</td>
            <td>{{ snapshot.diagnoses.B or "—" }}</td>
            <td>{{ snapshot.diagnoses.C or "—" }}</td>
            <td>{{ snapshot.diagnoses.D or "—" }}</td>
            <td>{{ snapshot.diagnoses.E or "—" }}</td>
            <td>{{ snapshot.diagnoses.F or "—" }}</td>
            <td>{{ snapshot.diagnoses.G or "—" }}</td>
            <td>{{ snapshot.diagnoses.H or "—" }}</td>
            <td>{{ snapshot.diagnoses.I or "—" }}</td>
            <td>{{ snapshot.diagnoses.J or "—" }}</td>
            <td>{{ snapshot.diagnoses.K or "—" }}</td>
            <td>{{ snapshot.diagnoses.L or "—" }}</td>
          </tr>
        </table>

        <div class="muted" style="margin-top:6px;">(Visual: A–L siempre visibles. No inventa diagnósticos.)</div>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 7: 24 A–J (tabla)
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell" style="grid-column: span 12;">
        <span class="label">24. Service Lines (24A–24J)</span>

        <table>
          <tr>
            <th class="th-24"><span class="code">24A</span><span class="desc">Date(s) of Service</span></th>
            <th class="th-24"><span class="code">24B</span><span class="desc">Place of Service</span></th>
            <th class="th-24"><span class="code">24C</span><span class="desc">EMG</span></th>
            <th class="th-24"><span class="code">24D</span><span class="desc">Procedures / Services</span></th>
            <th class="th-24"><span class="code">24E</span><span class="desc">Diagnosis Pointer</span></th>
            <th class="th-24 right"><span class="code">24F</span><span class="desc">Charges</span></th>
            <th class="th-24 right"><span class="code">24G</span><span class="desc">Days or Units</span></th>
            <th class="th-24"><span class="code">24I</span><span class="desc">ID Qual.</span></th>
            <th class="th-24"><span class="code">24J</span><span class="desc">Rendering Provider ID</span></th>
          </tr>

          {% for s in snapshot.services %}
          <tr>
            <td>{{ s.service_date or "—" }}</td>
            <td>11</td>
            <td>N</td>
            <td>{{ s.cpt_code or "—" }}</td>
            <td>{{ s.dx_pointer or "A" }}</td>
            <td class="right">—</td>
            <td class="right">{{ s.units or "—" }}</td>
            <td>—</td>
            <td>
              {{ snapshot.provider.billing.name or "—" }}<br>
              <span class="muted">NPI:</span> {{ snapshot.provider.billing.npi or "—" }}
            </td>
          </tr>
          {% endfor %}
        </table>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 8: 25 / 26 / 27
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">25. Federal Tax ID Number (SSN or EIN)</span>
        <div class="val">{{ snapshot.provider.billing.tax_id or "—" }}</div>
      </div>

      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">26. Patient’s Account No.</span>
        <div class="val">{{ snapshot.claim.id or "—" }}</div>
      </div>

      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">27. Accept Assignment?</span>
        <span class="opt"><span class="cb"></span>Yes</span>
        <span class="opt"><span class="cb"></span>No</span>
        <div class="muted">(visual por ahora)</div>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 9: 28 / 29 / 30
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">28. Total Charge</span>
        <div class="val">{{ snapshot.totals.total_charge }}</div>
      </div>
      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">29. Amount Paid</span>
        <div class="val">{{ snapshot.totals.amount_paid }}</div>
      </div>
      <div class="cell minh-36" style="grid-column: span 4;">
        <span class="label">30. Balance Due</span>
        <div class="val">{{ snapshot.totals.balance_due }}</div>
      </div>
    </div>
  </div>

  <!-- =========================
       BANDA 10: 31 / 32 / 33
       ========================= -->
  <div class="band">
    <div class="row">
      <div class="cell" style="grid-column: span 4;">
        <span class="label">31. Signature of Physician or Supplier (incl. degrees/credentials)</span>
        <div class="val">{{ snapshot.provider.signature or "Signature on File" }}</div>
        <div class="muted"><strong>Date:</strong> {{ snapshot.provider.signature_date or "" }}</div>
      </div>

      <div class="cell" style="grid-column: span 4;">
        <span class="label">32. Service Facility Location Information</span>
        <div class="val">
          {{ snapshot.provider.facility.name or "" }}<br>
          {{ snapshot.provider.facility.address or "" }}<br>
          {{ snapshot.provider.facility.city or "" }}, {{ snapshot.provider.facility.state or "" }} {{ snapshot.provider.facility.zip or "" }}
        </div>
      </div>

      <div class="cell" style="grid-column: span 4;">
        <span class="label">33. Billing Provider Info &amp; Ph #</span>
        <div class="val">
          {{ snapshot.provider.billing.name or "" }}<br>
          {{ snapshot.provider.billing.address or "" }}<br>
          {{ snapshot.provider.billing.city or "" }}, {{ snapshot.provider.billing.state or "" }} {{ snapshot.provider.billing.zip or "" }}<br>
          <span class="muted">NPI:</span> {{ snapshot.provider.billing.npi or "" }}<br>
          <span class="muted">Tax ID:</span> {{ snapshot.provider.billing.tax_id or "" }}
        </div>
      </div>
    </div>
  </div>

</body>
</html>
